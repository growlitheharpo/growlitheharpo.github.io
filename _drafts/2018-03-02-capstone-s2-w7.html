---
title: James Keats - Game Programmer
layout: default
---
<div class="contentBlock">
    <h2 class="elementTextWrapper">Capstone - Semester 2 Week 7</h2>
    <div>
        <div class="elementTextWrapper">
            <div>
                <p>Hard to believe we're just about halfway there! It's easy to see that the game is starting to
                    shapeup. Here's what I did this past sprint:</p>
            </div>
        </div>
        <div class="elementTextWrapper">
            <div>
                <h4>Team Gameplay</h4>
            </div>
        </div>
        <div class="elementTextWrapper">
            <div style="max-width: 100%;text-align:center;">
                <img src="/assets/img/blog/capstone/s2w7-newart.png"style="max-width:
                    100%;width: 100%;">
            </div>
        </div>
        <div class="elementTextWrapper">
            <div>
                <p>One of the biggest changes this week was the addition of team-based gameplay to re[Mod]. This
                    is something we've been planning since last semester, and never had a chance to get around to. The
                    idea was always to have two separate teams, an orange team and a blue team. Currently, the two teams
                    just fight it out in a team deathmatch, but if we get the chance, we'd like to add some sort of
                    objective for them to work towards. Ideas for this include a point-based system where capturing stage
                    areas wins extra points, giving those objectives more weight beyond just their value for legendary
                    parts.</p>
            </div>
        </div>
        <div class="elementTextWrapper">
            <div>
                <p>Implementing team mode turned out to be simpler than I thought. One of the core tenants I kept in mind
                    during this process was that all game logic should be fully compatible with both standard deathmatch
                    <b>and</b> team deathmatch. This lead to a lot of extra "if" statements and checks, but makes the
                    backend game logic more flexible going forward. Based on the direction provided byCharlie, our lead
                    designer, I set it up so that teams are assigned when players connect, all friendly fire damage is
                    ignored, and players HUDs and first- and third-person viewmodels are updated so that they appear to
                    be on the right team.</p>
            </div>
        </div>
        <div class="elementTextWrapper">
            <div class="columns">
                <div class="col-6 col-s-12">
                    <div>
                        <div class="elementTextWrapper" style="text-align:center">
                            <div style="max-width: 100%;text-align:center;">
                                <img src="/assets/img/blog/capstone/s2w7-orange.png" style="max-width:
                                    100%;width: 100%;">
                            </div>
                            <div>An orange player's HUD</div>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-s-12">
                    <div>
                        <div class="elementTextWrapper" style="text-align:center">
                            <div style="max-width: 100%;text-align:center;">
                                <img src="/assets/img/blog/capstone/s2w7-blue.png" style="max-width:
                                    100%;width: 100%;">
                            </div>
                            <div>A blue player's HUD</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="elementTextWrapper">
            <div>
                <p>Team gameplay is going to add a lot to re[Mod] going forward, and I'm excited to see where we cantake
                    it with the point system we've discussed.</p>
            </div>
        </div>
        <div class="elementTextWrapper">
            <div>
                <h4>Face Animations</h4>
            </div>
        </div>
        <div class="elementTextWrapper">
            <div>
                <p>Another addition that we've all been looking forward to adding to re[Mod] was facial animations
                    for the character. This has a much more minor impact on gameplay than team mode, but is still
                    something we've all been waiting excitedly for. Tyler, our lead artist, provided me with a sprite
                    sheet of faces to display on the player:</p>
            </div>
        </div>
        <div class="elementTextWrapper">
            <div style="max-width: 100%;text-align:center;"><img src="/assets/img/blog/capstone/s2w7_botface.png"
                    style="max-width: 500px;width: 100%;"></div>
        </div>
        <div class="elementTextWrapper">
            <div>
                <p>Unfortunately, we quickly discovered there was no easy way to utilize this in Unity when an individual
                    face needed to be applied to a model. We could've stuck a SpriteRenderer in front of the player's
                    face despite having a dedicated portion of the mesh and material ID for it, but that felt dirty. We
                    could've split the texture into 9 different ones, but that felt wasteful. In the end, I ended up
                    writing another custom shader that essentially acts as a SpriteRenderer but can be attached to normal
                    meshes, as long as the sprites are evenly spaced and sized:</p>
            </div>
        </div>
        <div class="elementTextWrapper" name="snippet">
            <div class="zpAlignPos" style="text-align:left">
                <!--snippet starts-->
                <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
                <meta name="Generator" content="Microsoft Word 15 (filtered)">
                <style>
                    /* Font Definitions */
                    @font-face {
                        font-family: "Cambria Math";
                        panose-1: 2 4 5 3 5 4 6 3 2 4;
                    }

                    @font-face {
                        font-family: Calibri;
                        panose-1: 2 15 5 2 2 2 4 3 2 4;
                    }

                    @font-face {
                        font-family: Consolas;
                        panose-1: 2 11 6 9 2 2 4 3 2 4;
                    }

                    /* Style Definitions */
                    p.MsoNormal,
                    li.MsoNormal,
                    div.MsoNormal {
                        margin-top: 0in;
                        margin-right: 0in;
                        margin-bottom: 8.0pt;
                        margin-left: 0in;
                        line-height: 107%;
                        font-size: 11.0pt;
                        font-family: "Calibri", sans-serif;
                    }

                    .MsoPapDefault {
                        margin-bottom: 8.0pt;
                        line-height: 107%;
                    }

                    @page WordSection1 {
                        size: 8.5in 11.0in;
                        margin: 1.0in 1.0in 1.0in 1.0in;
                    }

                    div.WordSection1 {
                        page: WordSection1;
                    }
                </style>
                <div class="WordSection1">
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:darkcyan">CGPROGRAM</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:#0000E0">#pragma</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple"> vertex vert</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:#0000E0">#pragma</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple"> fragment frag</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:#0000E0">#pragma</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple"> multi_compile_fog</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none">
                        <spanstyle="font-size:9.5pt;font-family:Consolas;color:black">
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    </p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:#0000E0">#include</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple"> "UnityCG.cginc"</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:darkblue">sampler2D</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> _MainTex;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:blue">int</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> _SpriteCountX;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:blue">int</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> _SpriteCountY;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:blue">int</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> _CurrentSprite;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:green">// input and appdata structs, and
                            vertex shader go here</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:blue">fixed4</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> </span><span
                            style="font-size:9.5pt;font-family:Consolas;color:darkcyan">frag</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> (</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:darkblue">v2f</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> i) : </span><span
                            style="font-size:9.5pt;font-family:Consolas;color:#0000E0">SV_Target</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">{</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:green">// Calculate the UV
                            size/range of each sprite in the spritesheet</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:blue">float</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> newRangeX = 1.0f / </span><span
                            style="font-size:9.5pt;font-family:Consolas;color:blue">float</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">(_SpriteCountX);</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:blue">float</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> newRangeY = 1.0f / </span><span
                            style="font-size:9.5pt;font-family:Consolas;color:blue">float</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">(_SpriteCountY);</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:green">// Find the x and y
                            position of _CurrentSprite</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:blue">uint</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> xPos = _CurrentSprite %
                            (</span><span style="font-size:9.5pt;font-family:Consolas;color:blue">uint</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">)_SpriteCountX;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:blue">uint</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> yPos = (_SpriteCountY - 1) -
                            (_CurrentSprite / (</span>
                        <spanstyle="font-size:9.5pt;font-family:Consolas;color:blue">uint</span>
                            <spanstyle="font-size:9.5pt;font-family:Consolas;color:black">)_SpriteCountY);</span>
                    </p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:green">// Adjust our uv
                            coordinate based on the sprite range and position</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            i.</span><span style="font-size:9.5pt;font-family:Consolas;color:purple">uv</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">.</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple">x</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> = (i.</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple">uv</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">.</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple">x</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">) * newRangeX + (xPos *
                            newRangeX);</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            i.</span><span style="font-size:9.5pt;font-family:Consolas;color:purple">uv</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">.</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple">y</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> = (i.</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple">uv</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">.</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple">y</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">) * newRangeY + (yPos *
                            newRangeY);</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:blue">fixed4</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> col = </span><span
                            style="font-size:9.5pt;font-family:Consolas;color:darkcyan">tex2D</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">(_MainTex, i.</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple">uv</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">);</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:green">// apply fog</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            UNITY_APPLY_FOG(i.</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:purple">fogCoord</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">, col);</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span><span style="font-size:9.5pt;font-family:Consolas;color:blue">return</span><span
                            style="font-size:9.5pt;font-family:Consolas;color:black"> col;</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:black">}</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none"><span
                            style="font-size:9.5pt;font-family:Consolas;color:darkcyan">ENDCG</span></p>
                    <p class="MsoNormal"
                        style="margin-bottom:0in;margin-bottom:.0001pt;line-height:normal;text-autospace:none">&nbsp;
                    </p>
                </div>
                <!--snippet ends-->
            </div>
        </div>
        <div class="elementTextWrapper">
            <div>
                <h4>Weapon Part Animations and the Gunpedia</h4>
            </div>
        </div>
        <div class="elementTextWrapper">
            <div>
                <p>The rest of my time this week was spent on more minor features, like weapon part animations and giving
                    the "Gunpedia" a facelift. The former was simply a matter of hooking up animators, and the latter was
                    just working with Charlie to rearrange some UI elements, so nothing of a particular technical note
                    there. Keep an eye out for the weapon part animations in future videos! They're most noticeable on
                    the grenade mechanism, rocket mechanism, and minigun!</p>
            </div>
        </div>
    </div>
</div>